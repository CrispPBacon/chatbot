import{r as u,a as j,u as N,c as S,b as d,j as o}from"./index-INcyO_Ty.js";function y(){const[r,l]=u.useState(""),[p,h]=u.useState([]),[g,i]=u.useState(!1),{auth:m,setConversationList:v}=j(),f=N(),{id:c}=S();u.useEffect(()=>{c&&d.get(`/api/chat/${c}`,{withCredentials:!0}).then(e=>h(e.data)).catch(e=>{var t,s;f("/",{replace:!0}),console.log(((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.error)||e)})},[c,f]);const w=e=>{r.trim()&&e.key=="Enter"&&!g&&(l(""),i(!0),C())},C=()=>{const e={content:r};if(c){const t={content:r,role:"user",conversation_id:c,user_id:m==null?void 0:m.user._id},s={messages:[t,...p]};h(a=>[t,...a]),d.post(`/api/chat/${c}`,{data:s},{withCredentials:!0}).then(a=>{h(n=>[...a.data,...n]),i(!1)}).catch(a=>{var n,x;console.log(((x=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:x.error)||a),i(!1)})}else d.post("/api/chat",{data:e},{withCredentials:!0}).then(t=>{f(t.data._id,{replace:!0}),i(!1),d.get("/api/chat",{withCredentials:!0}).then(s=>{v(s.data)}).catch(s=>{var a,n;return console.log(((n=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:n.error)||s)})}).catch(t=>{var s,a;console.log(((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.error)||t),i(!1)})};return o.jsxs("main",{className:"main light-shadow",children:[o.jsxs("div",{className:"message-container",children:[g?o.jsx("div",{className:"loader"}):null,p.map((e,t)=>o.jsx(E,{content:e.content,isUser:e.role=="user"},t))]}),o.jsx("div",{className:"input-container flex-center",children:o.jsx("input",{type:"text",placeholder:"Enter..",className:"form-control",autoComplete:"off",autoSave:"off",autoCorrect:"off",value:r,onChange:e=>l(e.target.value),onKeyDown:w})})]})}function E({isUser:r,content:l}){return o.jsx("div",{className:r?"message-row user-message":"message-row",children:o.jsx("span",{children:l})})}export{y as default};
